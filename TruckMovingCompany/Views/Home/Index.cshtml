@model TruckMovingCompany.ViewModels.HomeViewModel

@{
        ViewBag.Title = "Home Page";
}

@* Styling for this page is in Site.CSS *@

@* Background layer *@

    <div class="row">
        <div id="header" class="col-md-8">
            @* List all Movers *@

            <div id="headerView" style="padding-top: 15px;">
                @if (Model.Movers.Count() == 0)
            {
                    <div>
                        <p>There are no movers in the database</p>
                    </div>
                }

                else
                {
                    <div class="panel-group">
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                <p class="headers">Listed are all Movers in the Company</p>
                            </div>

                            <div class="panel-body">
                                <table class="table table-striped table-hover table-responsive table-condensed">
                                    <thead>
                                        <tr>
                                            <td class="table-header-td">First Name</td>
                                            <td class="table-header-td">Last Name</td>
                                            <td class="table-header-td">Crews</td>
                                        </tr>
                                    </thead>
                                    <tbody id="tableBody">
                                        @foreach (var i in Model.Movers)
                                        {
                                            <tr>
                                                <td>@i.FirstName</td>
                                                <td>@i.LastName</td>
                                                <td>
                                                    <select class="form-control">
                                                        @foreach (var j in i.Crews)
                                                        {
                                                            <option>
                                                                @j.CrewName
                                                            </option>
                                                        }
                                                    </select>
                                                </td>
                                                <td>
                                                    @using (Html.BeginForm("EditMover", "Home"))
                                                    {
                                                        @Html.Hidden(i.FirstName)
                                                        @Html.Hidden(i.LastName)

                                                        <button class="btn btn-xs btn-info" type="submit" style="width: 70px;">Edit</button>
                                                        <button class="btn btn-xs btn-danger deleteMover" type="button">Delete</button>
                                                    }
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                }
            </div>
        </div> @* End of header (displaying all movers) *@



        @* Form to create a Mover *@
        <div id="formLayer" class="col-md-4">
            <div class="container " id="form-container">
                <div id="add-a-mover-container">
                    <p class="headers" id="add-a-mover">Add a Mover</p>
                </div>
                <form role="form" id="moverForm" action="PostMover">
                    <div class="form-group">
                        <label class="form-label-text">First Name </label>
                        <input type="text" id="firstName" name="firstName" class="form-control" required />
                    </div>

                    <div class="form-group">
                        <label class="form-label-text">Last Name </label>
                        <input type="text" id="lastName" name="lastName" class="form-control" required />
                    </div>


                    <div class="form-group">
                        <label class="form-label-text">Add to Crew </label>
                        <select id="crewName" class="form-control">
                            @foreach (string CrewName in Model.CrewNames)
                            {
                                <option>
                                    @CrewName
                                </option>
                            }
                        </select>
                    </div>

                    <button type="button"  value="Save" class="btn btn-primary js-add-mover">Save</button>
                </form>
            </div>
        </div>
    </div>

@section scripts{
    <script>
        $(document).ready(function () {
            $(".js-add-mover").click(function () {

                var moverArray = [$("#firstName").val(),
                                  $("#lastName").val(),
                                  $("#crewName").val()];
                var length = moverArray.length;
                var error = false;
                var ArrayIndex = [];
                for (var i = 0; i < length; i++) {
                    if (moverArray[i] == "") {
                        error = true;
                        ArrayIndex.push(i);
                    }
                }

                if(error){
                    // Do Validation
                }else{
                    $.post("/api/AddAMover", {
                        FirstName: moverArray[0],
                        LastName: moverArray[1],
                        CrewName: moverArray[2]
                    })
                    .done(function () {
                        $("#firstName").val('');
                        $("#lastName").val('');

                        var row = '<tr>';
                        for (var i = 0; i < moverArray.length; i++) {
                            if (i < moverArray.length - 1) {
                                row = row.concat('<td>', moverArray[i], '</td>');
                            }
                            else {
                                row = row.concat('<td><select class = "form-control"><option>', moverArray[i], '</option></select></td>');
                                row = row.concat('<td>', '<form>', '<input type="hidden" name="firstName" value="', moverArray[0], '"/><input type="hidden" name="lastName" value="', moverArray[1], '"/><button class="btn btn-xs btn-info" type="submit" style="width: 70px;">Edit</button>  <button class="btn btn-xs btn-danger deleteMover" type="button">Delete</button></td></tr></form>');
                            }
                        }
                        var table = $("#tableBody");
                        table.append(row);

                    })
                    .fail(function () {

                        alert("Something failed.");
                    });
                }
            });
        });



    </script>
    
    }

